<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.store.mapper.CartMapper">
   <select id="findCartsByCustomerIdx" resultMap="CartResultMap">
        SELECT * FROM cart WHERE customer_idx = #{customerIdx}
    </select>

    <resultMap id="CartResultMap" type="com.store.dto.CartDTO">
        <id property="cartIdx" column="cart_idx"/>
        <result property="customerIdx" column="customer_idx"/>
        <collection property="cartItems" ofType="com.store.dto.CartDTO.CartItemDTO" column="cart_idx" select="findCartItemsByCartIdx"/>
    </resultMap>

    <select id="findCartItemsByCartIdx" resultType="com.store.dto.CartItemDTO">
         SELECT 
            ci.cart_item_idx AS cartItemIdx,
            ci.sku_value AS skuValue,
            ci.sku_idx AS skuIdx,
            s.sku_name AS skuName,
            s.sku_cost AS skuCost
        FROM cart_item ci
        JOIN sku s ON ci.sku_idx = s.sku_idx
        WHERE ci.cart_idx = #{cartIdx}
    </select>
  <select id="findAll" resultType="com.store.dto.CartItemDTO">
        SELECT 
            ci.cart_item_idx AS cartItemIdx,
            ci.cart_idx AS cartIdx,
            ci.sku_value AS skuValue,
            ci.sku_idx AS skuIdx,
            s.sku_name AS skuName,
            s.sku_cost AS skuCost
        FROM cart_item ci
        JOIN sku s ON ci.sku_idx = s.sku_idx
    </select>
   
</mapper>


